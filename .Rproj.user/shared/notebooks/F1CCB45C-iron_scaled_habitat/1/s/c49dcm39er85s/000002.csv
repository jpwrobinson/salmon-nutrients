"0","pred<-expand.grid(species = unique(focal$species),"
"0","						  site = levels(focal$site)[2],"
"0","						  habitat_dummy=c(0,1))"
"0",""
"0","	pred$trophic_level <-focal$trophic_level[match(pred$species, focal$species)]"
"0","	pred$Lmax <-focal$Lmax[match(pred$species, focal$species)]"
"0","	pred$K <-focal$K[match(pred$species, focal$species)]"
"0","	pred$tm <-focal$tm[match(pred$species, focal$species)]"
"0","	pred$benthic_pelagic_dummy <-focal$benthic_pelagic_dummy[match(pred$species,focal$species)]"
"0","	pred$family <-focal$family[match(pred$species, focal$species)]"
"0","	pred$habitat<-focal$habitat[match(pred$habitat_dummy, focal$habitat_dummy)]"
"0",""
"0","	# replace varying intercept samples with zeros (SITE AND FAMILY)"
"0","	# 1000 samples by 21 sites"
"0","	a_site_zeros <- matrix(0,1000,uniques(focal$site))"
"0","	"
"0","	post<-extract.samples(nt_m)"
"0","	post$X1<-a_site_zeros"
"0","	meds<-link(nt_m, data = pred, post=post, n=1000)"
"0",""
"0","	pred$mu<-apply(meds, 2, median)"
"0","	pred$lower95 <- apply( meds , 2 , HPDI , prob=0.95 )[1,]"
"0","	pred$upper95 <- apply( meds , 2 , HPDI , prob=0.95 )[2,]"
"0","	pred$lower50 <- apply( meds , 2 , HPDI , prob=0.50 )[1,]"
"0","	pred$upper50 <- apply( meds , 2 , HPDI , prob=0.50 )[2,]"
"0","	pred$nutrient<-nut"
"0","	mast<-pred"
"0",""
"0","	## estimate average nutrient concentration irrespective of species"
"0","	base<-expand.grid("
"0","						  family = unique(focal$family)[2],"
"0","						  site = levels(focal$site)[2], "
"0","						  species=unique(focal$species)[1],"
"0","						  trophic_level = 0, "
"0","						  Lmax = 0, "
"0","						  K = 0, "
"0","						  tm = 0, "
"0","						  benthic_pelagic_dummy = 0,"
"0","						  habitat_dummy =1)"
"0","	# replace varying intercept samples with zeros (SITE AND FAMILY)"
"0","	meds<-link(nt_m, data=base, n=1000, replace=list(X1=a_site_zeros, X2 = a_family_zeros))"
"0",""
"0","	base$mu<-apply(meds, 2, median)"
"0","	base$lower95 <- apply( meds , 2 , HPDI , prob=0.95 )[1,]"
"0","	base$upper95 <- apply( meds , 2 , HPDI , prob=0.95 )[2,]"
"0","	base$nutrient<-nut"
"0","	"
"0","# 	## transform mu"
"0","#     mast$mu<-exp(mast$mu)"
"0","#     mast$lower95<-exp(mast$lower95); mast$upper95<-exp(mast$upper95)"
"0","#     mast$lower50<-exp(mast$lower50); mast$upper50<-exp(mast$upper50)"
"0","#     base$mu<-exp(base$mu)"
"0","#     base$lower95<-exp(base$lower95); base$upper95<-exp(base$upper95)"
"0",""
